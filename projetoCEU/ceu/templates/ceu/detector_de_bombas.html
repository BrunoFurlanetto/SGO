{% extends 'base.html' %}
{% load static %}
{% include 'parciais/_head.html' %}

{% block conteudo %}
    <div class="conteudo-detector">
        <div class="titulo-resumo-ceu" align="center">
            <h2>DETECTOR DE BOMBAS</h2>
        </div>
        <hr>
        <div>
            <div id="pesquisa_evento">
                <form action="{% url 'detector' %}" method="GET">
                    <fieldset>
                        {% csrf_token %}
                        <div class="row">
                            <div class="datas" style="width: 32%">
                                <label for="id_data_inicio">Data início</label>
                                <input type="date" id="id_data_inicio" name="data_inicio" value="{{ request.GET.data_inicio }}" required>
                            </div>
                            <div class="datas" style="width: 32%">
                                <label for="id_data_final">Data final</label>
                                <input type="date" id="id_data_final" name="data_final" value="{{ request.GET.data_final }}" required>
                            </div>
                            <div class="div-botao" style="width: 10%">
                                <button type="submit" class="buton-search">
                                    <span><i class='bx bx-search'></i></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                </form>
                {% if pesquisado %}
                    <hr>
                    <div class="grupos row">
                        <div style="width: 65%">
                            <div>
                                <label for="clientes">Grupos:</label>
                            </div>
                            <div>
                                <select name="clientes" id="clientes" multiple>
                                    {% for evento in eventos %}
                                        <option value="{{ evento.ficha_de_evento.cliente.id }}">{{ evento.instituicao }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="div-btn-scan">
                            <button type="button" class="btn btn-scan" onclick="pegar_dados_evento()"><i class='bx bx-scan'></i></button>
                        </div>
                        <div class="div-btn-escalar-professores" style="width: 30%">
                            <button type="button" class="btn btn-outline-dark">Escalar professores</button>
                        </div>
                    </div>
                    <script>$('#clientes').select2()</script>
                {% endif %}
                <hr>
            </div>
            <div id="detector_de_bombas"></div>
            <div class="escala-por-atividades none">
                <hr>
                <h5 class="titulo-secao">Escala para as atividades</h5>
                <form action="{% url 'detector' %}" method="POST">
                    <fieldset id="formulario-escala-professores-atividades"></fieldset>
                </form>
            </div>

            <div class="modal fade" id="ModalProfessoresEvento" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <form id="dados_pre_reserva" action="{% url 'detector' %}" method="POST">
                        {% csrf_token %}
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"></h5>
                                <button class="btn-close" data-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <label for="id_professores_atividade">Professores para a atividade</label>
                                    <select name="professores_atividade" id="id_professores_atividade" multiple>
                                        <option></option>
                                        {% for professor in professores %}
                                            <option value="{{ professor.id }}">{{ professor.usuario.get_full_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer" id="modal_footer">
                                <script>
                                    $(document).ready(function() {
                                        $('#id_professores_atividade').select2({
                                            dropdownParent: $("#ModalProfessoresEvento")
                                        })
                                            .on("select2:select", function (evt) {
                                            let element = evt.params.data.element;
                                            let $element = $(element);

                                            $element.detach();
                                            $(this).append($element);
                                            $(this).trigger("change");
                                        });
                                    })
                                </script>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script src="{% static 'fullcalendar/lib/main.js' %}"></script><!-- Script para o calendário da escala -->
        <script src="{% static 'js/script_detector_de_bombas.js' %}"></script><!-- Script do calendário -->
        <script src="{% static 'js/Moment.js' %}"></script>
    </div>
{% endblock %}