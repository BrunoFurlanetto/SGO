{% extends 'base.html' %}
{% load static %}
{% load custom_tag %}
{% include 'parciais/_head.html' %}

{% block conteudo %}
    <link rel="stylesheet" href="{% static 'css/style_orcamento.css' %}">
    <link rel="stylesheet" href="{% static 'datepicker/daterangepicker.css' %}"/>
    <link rel="stylesheet" href="//cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{% static 'css/impressao_css.css' %}" type="text/css" id="style_impressao"/>
    <img id="logo_peraltas" class="none" src="{% static 'img/grupoPeraltas.png' %}" alt="">

    <div class="conteudo-orcamento">
        <div id="subtotal" class="div-flutuante none"
             style="{% if request.user in usuarios_gerencia or financeiro %} cursor: pointer; {% else %} pointer-events: none {% endif %}"
             onclick="$('#modal_descritivo').modal('show')">
            {% if request.user in usuarios_gerencia or financeiro %}
                <div class="floating-box none" id="floatingBox">Clique aqui</div>
            {% endif %}
            <strong>Valor final</strong><span></span>
        </div>
        <div class="head-orcamento">
            <h2>Orçamento</h2>
            <hr>
        </div>

        <form id="orcamento"
              name="orcamento" {% comment %}{% if tratativa %} action="{% url 'salvar_orcamento_clone' tratativa.id %}" {% else %} action="{% url 'salvar_orcamento' %}" {% endif %}{% endcomment %}>
            <fieldset>
                {% csrf_token %}
                {{ orcamento.apelido.as_hidden }}
                <input type="hidden" id="id_pacote_promocional" name="id_pacote_promocional"
                       value="{{ dados_pacote.id }}">
                {% if id_orcamento %}<input type="hidden" name="id_tratativa" id="id_tratativa"
                                            value="{{ tratativa.id_tratativa }}">{% endif %}
                <input type="hidden" name="salvar_previa" id="salvar_previa">
                {% if previa %}
                    <input type="hidden" name="id_previa_orcamento" id="id_previa_orcamento" value="{{ id_orcamento }}">
                {% endif %}
                <div id="conteudo_primeiro" class="conteudo-primeiro">
                    <h5 class="titulo-secao">Informações do cliente e responsável</h5>
                    <div onclick="ativar_mascara()">
                        {{ orcamento.cliente.label }}
                        {{ orcamento.cliente }}
                    </div>
                    <div class="mt-2">
                        {{ orcamento.responsavel.label }}
                        {{ orcamento.responsavel }}
                    </div>

                    {% if financeiro %}
                        <div class="mt-2" style="display: flex; column-gap: 7px; align-items: center">
                            {{ orcamento.promocional }}
                            <label for="id_promocional">{{ orcamento.promocional.label }}</label>
                            <button type="button" {% if not dados_pacote %} disabled {% endif %}
                                    data-toggle="modal" data-target="#dados_do_pacote"
                                    id="btn_dados_pacote">
                                <i class='bx bx-message-square-edit'></i>
                            </button>
                        </div>
                        {{ orcamento.pacote_promocional.as_hidden }}
                    {% endif %}
                </div>
                <div id="container_periodo" class="{% if not id_orcamento %} none {% endif %}">
                    <div id="periodo_viagem" class="conteudo">
                        <div id="periodo" onchange="verificar_preenchimento()">
                            <h5 class="titulo-secao">Período da viagem</h5>
                            <label for="data_viagem">Data da viagem</label>
                            <input type="text" class="data_daterange" name="data_viagem" id="data_viagem"
                                   onchange="separar_produtos(this)"/>
                            <label for="produto">Produto</label>
                            {{ orcamento.produto }}
                        </div>
                        <hr>
                        <div id="promocionais" class="{% if orcamento_origem.promocional %} none {% endif %}">
                            <div>
                                <label for="{{ orcamento.orcamento_promocional.id_for_label }}">{{ orcamento.orcamento_promocional.label }}</label>
                                {{ orcamento.orcamento_promocional }}
                            </div>
                            <button type="button" name="info_promocional" {% if not dados_pacote %} disabled {% endif %}
                                    title="Pacotes promocionais que se encaixam no periodo e no produto escolhido"
                                    id="info_promocional" onclick="$('#dados_do_pacote').modal('show')">
                                <i class='bx bx-info-circle'></i>
                            </button>
                        </div>
                    </div>
                    <div class="parcial"></div>
                </div>
                <div id="campos_fixos">
                    <div id="container_monitoria_transporte" style="margin-bottom: -55px"
                         class="{% if not id_orcamento %} none {% endif %}">
                        <div id="monitoria_transporte" class="row" style="padding: 0 10px 10px"
                             onchange="verificar_monitoria_transporte()">
                            <div id="monitoria" class="conteudo" style="width: 62%">
                                <h5 class="titulo-secao">Monitoria</h5>
                                <div>
                                    {{ orcamento.tipo_monitoria.label }}
                                    {{ orcamento.tipo_monitoria }}
                                </div>
                            </div>
                            <div class="conteudo" style="width: 35%">
                                <h5 class="titulo-secao">Transporte a partir de São Paulo</h5>
                                <div id="transporte">
                                    {{ orcamento.transporte }}
                                </div>
                            </div>
                        </div>
                        <div class="parcial"></div>
                    </div>
                    <div id="container_opcionais" style="margin-bottom: -45px"
                         class="{% if not id_orcamento %} none {% endif %}">
                        <div id="opcionais" class="conteudo">
                            <h5 class="titulo-secao">Opcionais</h5>
                            <div>
                                {% for categoria, opcional in orcamento.opcionais_por_categoria.items %}
                                    <div class="mt-2 flex-column">
                                        <label for="{{ opcional.id_for_label }}">{{ categoria }}</label>
                                        <select id="{{ opcional.id_for_label }}" name="opcionais" multiple>
                                            {% for option in opcional.field.queryset %}
                                                <option value="{{ option.id }}"
                                                        {% if option.id|stringformat:"s" in opcional.value|stringformat:"s" %}selected{% endif %}>{{ option }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="row mt-3">
                                <p>Outros itens</p>
                                <hr>
                                <div id="legenda_opcionais_extra" class="none">
                                    <p>Nome</p>
                                    <p>Descrição</p>
                                    <p>Valor</p>
                                </div>
                                <div id="lista_opcionais_extra"></div>
                                <div>
                                    <button id="botao_add_opcionais" type="button"
                                            onclick="$('#adicionar_opcional').modal('show'); $('#adicionar_opcional input, #adicionar_opcional textarea').val('')">
                                        Adicionar outro item
                                        <i class='bx bx-plus'></i>
                                    </button>
                                </div>
                            </div>
                            <hr>
                            {% if financeiro %}
                                <button id="botao_lista_valores" class="mt-3" type="button" onclick="$('#valores_outros_opcionais').modal('show');
                                                                                                $('#btn_salvar_orcamento').prop('disabled', false)">
                                    <i class='bx bxs-food-menu'></i>
                                    Lista de valores
                                </button>
                            {% endif %}
                        </div>
                        <div class="parcial"></div>
                    </div>
                </div>
                <div id="finalizacao" class="conteudo {% if not id_orcamento %} none {% endif %}">
                    <h5 class="titulo-secao">Observações</h5>
                    <div>
                        <label for="observacoes_orcamento">Observações gerais do orçamento</label>
                        <textarea name="observacoes" id="observacoes_orcamento" cols="30"
                                  rows="10"></textarea>
                    </div>
                    {{ orcamento.comentario_desconto.as_hidden }}
                    {{ orcamento.aprovacao_diretoria.as_hidden }}
                    <input type="hidden" name="colaborador" value="{% if gerente_aprovando %}{{ orcamento_origem.colaborador.id }}{% else %}{{ request.user.id }}{% endif %}"
                           id="id_colaborador">
                    <div class="botoes">
                        <p id="aviso_comentario_gerencia" class="alert alert-warning w-100 none">
                            Para que o orçamento seja salvo é necessário que haja um comentário por parte do gerente
                            devido ao desconto fornecido!
                        </p>
                        {% if gerente_aprovando %}
                            <button type="button" id="btn_salvar_orcamento" class="btn btn-primary"
                                    onclick="aprovar_orcamento({{ orcamento_origem.id | safe }})">
                                Aprovar orçamento
                            </button>
                        {% else %}
                            <button type="button" id="pedido_desconto" class="btn btn-outline-info" data-toggle="modal"
                                    data-target="#modal_cometario_diretoria">Pedido de alteração de taxa
                            </button>
                            <button type="button" id="btn_salvar_previa_orcamento" class="btn btn-dark"
                                    data-toggle="modal"
                                    data-target="#modal_apelido_orcamento">
                                Salvar prévia
                            </button>
                            <button type="button" id="btn_salvar_orcamento" class="btn btn-primary"
                                    onclick="salvar_orcamento()">
                                Salvar orçamento
                            </button>
                        {% endif %}
                    </div>
                </div>
            </fieldset>
        </form>
    </div>

    <!--  Modal para adicionar um novo opcional  -->
    <div class="modal fade" id="adicionar_opcional" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Adicionar novo opcional extra</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div>
                        <p id="aviso" class="alert alert-warning none"></p>
                    </div>
                    <div class="row">
                        <div style="width: 73%">
                            <label for="nome_opcional">Nome do opcional</label>
                            <input type="text" name="nome_opcional" id="nome_opcional" required>
                        </div>
                        <div style="width: 27%">
                            <label for="valor_opcional">Valor</label>
                            <input type="text" name="valor_opcional" id="valor_opcional" required>
                        </div>
                    </div>
                    <div class="mt-3">
                        <label for="descricao_opcional">Descrição</label>
                        <textarea name="descricao_opcional" id="descricao_opcional" cols="30" rows="10"
                                  required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="adicionar_novo_op()">Salvar</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Voltar</button>
                </div>
            </div>
        </div>
    </div>

    <!--  Modal valores dos outros opcionais  -->
    <div class="modal fade" id="valores_outros_opcionais" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Lista de valores extra</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="forms_valores_op" method="POST">
                        <table id="tabela_de_opcionais" class="table table-hover table-striped">
                            <thead>
                            <tr>
                                <th style="width: 50%">Opcional</th>
                                <th style="width: 25%">Valor</th>
                                <th style="width: 25%">Desconto</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for op in orcamento_origem.listar_opcionais %}
                                {% if op.categoria != 'extra' %}
                                    <tr id="opcionais_{{ op.id }}" class="opcionais">
                                        <th><input type="text" id="nome_opcionais_{{ forloop.counter }}"
                                                   name="opcionais_{{ forloop.counter }}"
                                                   value="{{ op.nome }}" disabled></th>
                                        <input type="hidden" id="id_opcionais_{{ forloop.counter }}"
                                               name="opcionais_{{ forloop.counter }}"
                                               value="{{ op.id }}">
                                        <input type="hidden"
                                               id="valor_bd_opcionais_{{ forloop.counter }}"
                                               name="opcionais_{{ forloop.counter }}"
                                               value='{{ op.valor }}' disabled>
                                        <th><input type="text" id="valor_opcionais_{{ forloop.counter }}"
                                                   disabled
                                                   name="opcionais_{{ forloop.counter }}"
                                                   value='{{ op.valor_com_desconto | substituir_ponto }}'></th>
                                        <th><input type="text"
                                                   id="desconto_opcionais_{{ forloop.counter }}"
                                                   name="opcionais_{{ forloop.counter }}"
                                                   data-limite_desconto="{{ op.valor }}"
                                                   value="{{ op.desconto | substituir_ponto }}"
                                                   onchange="aplicar_desconto(this)"></th>
                                    </tr>
                                {% else %}
                                    <tr id="opcionais_extra_{{ op.id }}" class="opcionais">
                                        <th><input type="text" id="nome_opcionais_extra_{{ forloop.counter }}"
                                                   name="opcionais_extra_{{ forloop.counter }}"
                                                   value="{{ op.nome }}" disabled></th>
                                        <input type="hidden" id="id_opcionais_extra_{{ forloop.counter }}"
                                               name="opcionais_extra_{{ forloop.counter }}"
                                               value="{{ op.id }}">
                                        <input type="hidden"
                                               id="valor_bd_opcionais_extra_{{ forloop.counter }}"
                                               name="opcionais_extra_{{ forloop.counter }}"
                                               value='{{ op.valor }}' disabled>
                                        <th><input type="text" id="valor_opcionais_extra_{{ forloop.counter }}"
                                                   disabled
                                                   name="opcionais_extra_{{ forloop.counter }}"
                                                   value='{{ op.valor_com_desconto | substituir_ponto }}'></th>
                                        <th><input type="text"
                                                   id="desconto_opcionais_extra_{{ forloop.counter }}"
                                                   name="opcionais_extra_{{ forloop.counter }}"
                                                   data-limite_desconto="{{ op.valor }}"
                                                   disabled value="{{ op.desconto | substituir_ponto }}"
                                                   onchange="aplicar_desconto(this)"></th>
                                    </tr>
                                {% endif %}

                            {% endfor %}
                            </tbody>
                        </table>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="atualizar_valores_op(true)">
                        Salvar
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Voltar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg" id="modal_descritivo" tabindex="-1" role="dialog"
         aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" style="max-width: 1200px">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Descritivo de valores</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form_gerencia" method="POST">
                        <fieldset>
                            {% csrf_token %}
                            <input type="hidden" name="id_gerente" id="id_gerente" {% if  gerente_aprovando %}
                                   value="{{ request.user }}" {% endif %}>
                            <h5>Parâmetros da gerência</h5>
                            <div style="border: dashed 1px #5c636a">
                                <div id="campos_alteraveis" style="display: flex; column-gap: 50px; padding: 20px"
                                     onchange="verificar_alteracoes(this)">
                                    {% for taxa in taxas_padrao %}
                                        {% if taxa.aparecer_comercial %}
                                            {% if not zerar_taxas %}
                                                {% for taxa_orcamento, valor in orcamento_origem.objeto_gerencia.items %}
                                                    {% if taxa_orcamento == taxa.id_taxa %}
                                                        <div>
                                                            <label>{{ taxa.nome_taxa_comercial }}</label>
                                                            <input type="{{ taxa.tipo_variavel }}"
                                                                   id="{{ taxa.id_taxa }}"
                                                                   name="{{ taxa.id_taxa }}"
                                                                   value="{% if taxa.tipo_variavel == 'text' %}{{ valor|formatar_porcentagem }}{% else %}{{ valor }}{% endif %}"
                                                                   data-nome_taxa="{{ taxa.nome_taxa_comercial }}"
                                                                   data-valor_default="{{ taxa.valor_padrao_formatado }}"
                                                                   data-valor_inicial="{% if taxa.tipo_variavel == 'text' %}{{ valor|formatar_porcentagem }}{% else %}{{ valor }}{% endif %}"
                                                                   data-valor_alterado="{% if taxa.tipo_variavel == 'text' %}{{ valor|formatar_porcentagem }}{% else %}{{ valor }}{% endif %}"
                                                                    {% if taxa.valor_maximo %}
                                                                   data-teto="{{ taxa.valor_maximo_formatado }}" {% endif %}
                                                                    {% if taxa.valor_minimo|floatformat %}
                                                                   data-piso="{{ taxa.valor_minimo_formatado }}" {% endif %}>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            {% else %}
                                                <div>
                                                    <label>{{ taxa.nome_taxa_comercial }}</label>
                                                    <input type="{{ taxa.tipo_variavel }}" id="{{ taxa.id_taxa }}"
                                                           name="{{ taxa.id_taxa }}"
                                                           data-nome_taxa="{{ taxa.nome_taxa_comercial }}"
                                                           value="{{ taxa.valor_padrao_formatado }}"
                                                           data-valor_default="{{ taxa.valor_padrao_formatado }}"
                                                           data-valor_inicial="{{ taxa.valor_padrao_formatado }}"
                                                           data-valor_alterado="{{ taxa.valor_padrao_formatado }}"
                                                            {% if taxa.valor_maximo %}
                                                           data-teto="{{ taxa.valor_maximo_formatado }}" {% endif %}
                                                            {% if taxa.valor_minimo|floatformat %}
                                                           data-piso="{{ taxa.valor_minimo_formatado }}" {% endif %}>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    <div>
                                        <label for="desconto_geral">Desconto</label>
                                        <input type="text" id="desconto_geral" name="desconto_geral"
                                               value="0,00"
                                               data-valor_default="0,00" data-valor_inicial="0,00"
                                               data-valor_alterado="0,00">
                                        <input type="hidden" name="desconto_geral_alterado"
                                               id="desconto_geral_alterado"
                                               value="0">
                                    </div>
                                    <div>
                                        <label for="valor_final">Valor final</label>
                                        <input disabled type="text" id="valor_final">
                                    </div>
                                </div>
                                <p id="avisos_pisos_tetos" class="none alert alert-warning"></p>
                                <div id="div_observacoes_gerencia" class="none"
                                     style="width: 90%; margin-left: 5%; margin-bottom: 10px;">
                                    <label for="observacoes_gerencia">Observações</label>
                                    <textarea name="observacoes_gerencia" id="observacoes_gerencia" cols="30"
                                              rows="10" onkeyup="verificar_cometario_gerencia(this)"></textarea>
                                </div>
                                <div>
                                    <p id="alteracoes_aviso" class="alert alert-warning none">Alterações de taxas não
                                        altorizadas pela gerência!</p>
                                </div>
                            </div>
                            <hr  {% if not perms.orcamento.add_dadosdepacotes %} class="none" {% endif %}>
                            <h5 {% if not perms.orcamento.add_dadosdepacotes %} class="none" {% endif %}>Parâmetros de
                                pacotes</h5>
                            <div id="div_financeiro" {% if not perms.orcamento.add_dadosdepacotes %}
                                 class="none" {% endif %}>
                                <div>
                                    <div>
                                        <div class="div_desconto_percent">
                                            <label for="desconto_produto_percent">
                                                Desconto diaria (%)
                                                <button type="button" class="btn-troca-desconto"
                                                        onclick="trocar_modalidade_desconto(this)"><i
                                                        class='bx bx-transfer-alt'></i></button>
                                            </label>
                                            <input type="text" id="desconto_produto_percent"
                                                   name="desconto_produto_percent"
                                                   value="{% if orcamento_origem %}{{ orcamento_origem.desconto_percentual_diaria }}{% else %}0,00{% endif %}%"
                                                   onchange="enviar_infos_gerencia()">
                                        </div>
                                        <div class="div_desconto_real none">
                                            <label for="desconto_produto_real">
                                                Desconto diaria ($)
                                                <button type="button" class="btn-troca-desconto"
                                                        onclick="trocar_modalidade_desconto(this)"><i
                                                        class='bx bx-transfer-alt'></i></button>
                                            </label>
                                            <input type="text" id="desconto_produto_real" name="desconto_produto_real"
                                                   value="{% if orcamento_origem %}{{ orcamento_origem.desconto_real_diaria }}{% else %}0,00{% endif %}"
                                                   onchange="enviar_infos_gerencia()">
                                        </div>
                                    </div>
                                    <div>
                                        <div class="div_desconto_percent">
                                            <label for="desconto_monitoria_percent">
                                                Desconto monitoria (%)
                                                <button type="button" class="btn-troca-desconto"
                                                        onclick="trocar_modalidade_desconto(this)"><i
                                                        class='bx bx-transfer-alt'></i></button>
                                            </label>
                                            <input type="text" id="desconto_monitoria_percent"
                                                   name="desconto_monitoria_percent"
                                                   value="{% if orcamento_origem %}{{ orcamento_origem.desconto_percentual_monitoria }}{% else %}0,00{% endif %}%"
                                                   onchange="enviar_infos_gerencia()">
                                        </div>
                                        <div class="div_desconto_real none">
                                            <label for="desconto_monitoria_real">
                                                Desconto monitoria ($)
                                                <button type="button" class="btn-troca-desconto"
                                                        onclick="trocar_modalidade_desconto(this)"><i
                                                        class='bx bx-transfer-alt'></i></button>
                                            </label>
                                            <input type="text" id="desconto_monitoria_real"
                                                   name="desconto_monitoria_real"
                                                   value="{% if orcamento_origem %}{{ orcamento_origem.desconto_real_monitoria }}{% else %}0,00{% endif %}"
                                                   onchange="enviar_infos_gerencia()">
                                        </div>
                                    </div>
                                    <div>
                                        <div class="div_desconto_percent">
                                            <label for="desconto_transporte_percent">
                                                Desconto transporte (%)
                                                <button type="button" class="btn-troca-desconto"
                                                        onclick="trocar_modalidade_desconto(this)"><i
                                                        class='bx bx-transfer-alt'></i></button>
                                            </label>
                                            <input type="text" id="desconto_transporte_percent"
                                                   name="desconto_transporte_percent"
                                                   value="{% if orcamento_origem %}{{ orcamento_origem.desconto_percentual_transporte }}{% else %}0,00{% endif %}%"
                                                   onchange="enviar_infos_gerencia()">
                                        </div>
                                        <div class="div_desconto_real none">
                                            <label for="desconto_transporte_real">
                                                Desconto transporte ($)
                                                <button type="button" class="btn-troca-desconto"
                                                        onclick="trocar_modalidade_desconto(this)"><i
                                                        class='bx bx-transfer-alt'></i></button>
                                            </label>
                                            <input type="text" id="desconto_transporte_real"
                                                   name="desconto_transporte_real"
                                                   value="{% if orcamento_origem %}{{ orcamento_origem.desconto_real_transporte }}{% else %}0,00{% endif %}"
                                                   onchange="enviar_infos_gerencia()">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label for="data_vencimento">Data de vencimento</label>
                                    <input type="date" name="data_vencimento" id="data_vencimento" required
                                           onchange="$('#btn_salvar_orcamento').prop('disabled', $('#data_vencimento').val() == '')">
                                </div>
                            </div>
                            <div>
                                <strong>Apelido do orçamento:</strong> {{ orcamento_origem.apelido }}
                                <br>
                                <strong>Nome do pacote:</strong> {{ dados_pacote.nome_do_pacote }}
                            </div>
                        </fieldset>
                    </form>
                    <hr>
                    <form id="form_descritivo" method="POST">
                        <fieldset>
                            {% csrf_token %}
                            <h5 class="titulo-secao">Tabela de valores</h5>
                            <table id="tabela_de_valores" class="table table-hover table-borderless">
                                <thead>
                                <tr>
                                    <th colspan="7"></th>
                                    <th class="tag_datas">Datas</th>
                                </tr>
                                <tr class="cabecalho">
                                    <th></th>
                                    <th style="width: 50%">Seção</th>
                                    <th style="width: 25%">Valor</th>
                                    <th style="width: 25%">Taxa comercial</th>
                                    <th style="width: 25%">Comissão</th>
                                    <th style="width: 25%">Desconto</th>
                                    <th class="valor_final_tabela" style="width: 25%">Valor + taxas</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    {% comment %} TODO: Trocar pra quando não for do financeiro depois {% endcomment %}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Voltar</button>
                    {% if financeiro %}
                        <button type="button" class="btn btn-dark" id="btnPrint">Imprimir</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="dados_do_pacote" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Dados do pacote</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form_dados_pacote" method="POST">
                        <fieldset>
                            {% csrf_token %}
                            <input type="hidden" name="id_pacote" id="id_pacote" value="{{ dados_pacote.id }}">
                            <h5 class="titulo-secao">Nome e descrição do pacote</h5>
                            <div class="secao">
                                <div style="width: 100%">
                                    {{ pacote_promocional.nome_do_pacote.label_tag }}
                                    {{ pacote_promocional.nome_do_pacote }}
                                </div>
                                <div class="mt-2" style="width: 100%">
                                    {{ pacote_promocional.descricao.label_tag }}
                                    {{ pacote_promocional.descricao }}
                                </div>
                            </div>
                            <hr>
                            <h5 class="titulo_secao">Limites</h5>
                            <div class="secao">
                                <div style="width: 47%">
                                    {{ pacote_promocional.limite_desconto_geral.label_tag }}
                                    {{ pacote_promocional.limite_desconto_geral }}
                                </div>
                                <div style="width: 47%">
                                    {{ pacote_promocional.minimo_de_diarias.label_tag }}
                                    {{ pacote_promocional.minimo_de_diarias }}
                                </div>
                                <div style="width: 47%" class="mt-2">
                                    {{ pacote_promocional.maximo_de_diarias.label_tag }}
                                    {{ pacote_promocional.maximo_de_diarias }}
                                </div>
                                <div style="width: 47%" class="mt-2">
                                    {{ pacote_promocional.minimo_de_pagantes.label_tag }}
                                    {{ pacote_promocional.minimo_de_pagantes }}
                                </div>
                                <div class="mt-2" style="display: flex; align-items: center">
                                    <label for="{{ pacote_promocional.regra_cortesia.id_for_label }}" class="me-2">Uma
                                        cortesia para cada</label>
                                    {{ pacote_promocional.regra_cortesia }}
                                </div>
                            </div>
                            <hr>
                            <h5 class="titulo-secao">Produtos elegíveis</h5>
                            <div class="secao">
                                <div style="width: 100%">
                                    {{ pacote_promocional.produtos_elegiveis }}
                                </div>
                            </div>
                            <hr>
                            <h5 class="titulo-secao">Períodos aplicáveis</h5>
                            <div id="lista_de_periodos" class="mb-3">
                                {% if dados_pacote %}
                                    {{ dados_pacote.montar_dados_periodos|safe }}
                                {% else %}
                                    <div class="div_periodos_aplicaveis">
                                        <div class="periodos">
                                            <input type="text" id="periodo_1" name="periodo_1"
                                                   class="periodos_aplicaveis">
                                            <button type="button" class="btn_remover_periodo"
                                                    onclick="remover_periodo(this)">
                                                <span>&times;</span></button>
                                        </div>
                                        <div class="dias mt-2">
                                            <div>
                                                <input id="input_seg" type="checkbox" name="dias_periodo_1" value="0">
                                                <label for="input_seg">Seg</label>
                                            </div>
                                            <div>
                                                <input id="input_ter" type="checkbox" name="dias_periodo_1" value="1">
                                                <label for="input_ter">Ter</label>
                                            </div>
                                            <div>
                                                <input id="input_qua" type="checkbox" name="dias_periodo_1" value="2">
                                                <label for="input_qua">Qua</label>
                                            </div>
                                            <div>
                                                <input id="input_qui" type="checkbox" name="dias_periodo_1" value="3">
                                                <label for="input_qui">Qui</label>
                                            </div>
                                            <div>
                                                <input id="input_sex" type="checkbox" name="dias_periodo_1" value="4">
                                                <label for="input_sex">Sex</label>
                                            </div>
                                            <div>
                                                <input id="input_sab" type="checkbox" name="dias_periodo_1" value="5">
                                                <label for="input_sab">Sab</label>
                                            </div>
                                            <div>
                                                <input id="input_dom" type="checkbox" name="dias_periodo_1" value="6">
                                                <label for="input_dom">Dom</label>
                                            </div>
                                        </div>
                                        <div id="horas_permitidas" class="mt-2">
                                            <div id="check_in">
                                                <label>Periodo de check in</label>
                                                <div>
                                                    <input type="time" name="check_in_permitido_1">
                                                    a
                                                    <input type="time" name="check_in_permitido_1">
                                                </div>
                                            </div>
                                            <div id="check_out" class="mt-2">
                                                <label>Periodo de check out</label>
                                                <div>
                                                    <input type="time" name="check_out_permitido_1">
                                                    a
                                                    <input type="time" name="check_out_permitido_1">
                                                </div>
                                            </div>
                                        </div>
                                        <hr style="width: 100%">
                                    </div>
                                {% endif %}
                            </div>
                            {% if financeiro %}
                                <button type="button" class="btn btn-outline-success"
                                        onclick="adicionar_periodo_novo()">
                                    Adicionar periodo
                                </button>
                            {% endif %}
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    {% if financeiro %}
                        <button type="button" class="btn btn-primary" onclick="salvar_dados_do_pacote()">
                            Salvar
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="verificacao_gerencia" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Verificação da Gerência</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="server_error" class="none alert alert-danger"></p>
                    <p id="login_error" class="none alert alert-warning"></p>
                    <div class="mb-3">
                        <label for="usuario">Usuário</label>
                        <select name="usuario" id="usuario">
                            <option></option>
                            {% for usuario in usuarios_gerencia %}
                                <option value="{{ usuario.id }}">{{ usuario.get_full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="senha">Senha</label>
                        <input type="text" name="senha" id="senha" autocomplete="off">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="verificar_gerencia()">Logar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_apelido_orcamento" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalLabel"
         aria-hidden="true"
         onmousemove="$('#btn_salvar_apelido').prop('disabled', $('#apelido_orcamento').val().length < 5)">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Apelido do orçamento</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <label for="apelido_orcamento">Forneça um apelido para o orçamento</label>
                    <input type="text" id="apelido_orcamento" name="apelido_orcamento" onkeyup="atribuir_apelaido(this)"
                           required>
                </div>
                <div class="modal-footer">
                    <button id="btn_salvar_apelido" type="button" class="btn btn-primary"
                            onclick="salvar_orcamento(true)" disabled>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_cometario_diretoria" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pedido de alteração de taxa para a gerência</h5>
                    <button type="button" class="x-fechar-modal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div>
                        <ul id="avisos_apelidos" class="none alert alert-warning px-lg-4">
                            <li id="aviso_apelido" class="none">Um apelido para o orçamento deve ser informado com pelo
                                menos 5 caracteres!
                            </li>
                            <li id="aviso_comentario" class="none">O comentário para a gerência deve conter no mínimo 10
                                caracteres!
                            </li>
                        </ul>
                    </div>
                    <div>
                        <label for="apelido_orcamento_2">Apelido</label>
                        <input type="text" name="apelido_orcamento_2" id="apelido_orcamento_2"
                               onkeyup="atribuir_apelaido(this)" required>
                    </div>
                    <label for="apelido_orcamento">Comentário para a gerência</label>
                    <textarea name="comentario_gerencia" id="comentario_gerencia" cols="30" rows="10"
                              required>{{ orcamento.comentario_desconto.value }}</textarea>
                </div>
                <div class="modal-footer">
                    <button id="btn_salvar_comentario" type="button" class="btn btn-primary"
                            onclick="salvar_comentario_diretoria()">Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(async () => {
            {% if id_orcamento %}
                await inicializacao('{{ orcamento.check_in.value | date:'d/m/Y H:i' }}', '{{ orcamento.check_out.value | date:'d/m/Y H:i' }}')
                $('#orcamento input, #orcamento select').prop('disabled', false)
                await verificar_monitoria_transporte()
                await preencher_op_extras({{ id_orcamento|safe }}, true)
                $('#data_viagem, #id_opcionais, #op_extras, #id_atividades, #id_atividades_ceu').trigger('change')
                $('#conteudo_primeiro select').prop('disabled', true)
                $('#tabela_de_opcionais input').maskMoney({
                    prefix: 'R$ ',
                    thousands: '.',
                    decimal: ',',
                    allowZero: true,
                    affixesStay: false,
                })
            {% else %}
                await inicializacao();
            {% endif %}
        })
    </script>

    <script src="{% static 'js/scripts_orcamento.js' %}"></script>
    <script src="{% static 'js/Moment.js' %}"></script>
    <script src="{% static 'js/Moment_timezone.js' %}"></script>
    <script src="{% static 'js/masks.js' %}"></script> <!-- Máscaras -->
    <script src="{% static 'js/maskMoney.js' %}"></script>
    <script src="{% static 'datepicker/daterangepicker.js' %}"></script>
{% endblock %}
