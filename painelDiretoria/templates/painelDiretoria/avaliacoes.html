{% extends "base.html" %}

{% block conteudo %}
    <div class="bg-white p-3 rounded-4 shadow mb-4" style="width: 80%; margin: auto; border-radius: 1.5rem">
        <div>
            <h1 class="fs-3 fw-bold">Dashboard de Avaliações</h1>
        </div>

        <div class="container-fluid py-4">
            {% if perms.pesquisasSatisfacao.view_coordenacaoavaliandomonitoria %}
                <!-- Avaliações de Monitores -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        Avaliações de Monitores
                    </div>
                    <div class="card-body table-responsive">
                        {% if avaliacoes_monitores %}
                            <table class="table table-striped table-bordered align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Cliente</th>
                                    <th>Check-in</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for avaliacao in avaliacoes_monitores %}
                                    <tr style="cursor: pointer" onclick="window.location.href='{% url 'ver_avaliacao_monitores' avaliacao.id %}'">
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ avaliacao.ordem_de_servico.instituicao }}</td>
                                        <td>{{ avaliacao.ordem_de_servico.check_in|date:"d/m/Y H:i" }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="alert alert-warning mt-3 mb-0">Nenhuma avaliação de monitor encontrada.</div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {% if perms.pesquisasSatisfacao.view_monitoravaliandocoordenacao %}
                <!-- Avaliações de Coordenadores -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        Avaliações de Coordenadores
                    </div>
                    <div class="card-body table-responsive">
                        {% if avaliacoes_coordenadores %}
                            <table class="table table-striped table-bordered align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Cliente</th>
                                    <th>Check-in</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for avaliacao in avaliacoes_coordenadores %}
                                    <tr style="cursor: pointer" onclick="window.location.href='{% url 'ver_avaliacao_coordenadores' avaliacao.id %}'">
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ avaliacao.ordem_de_servico.instituicao }}</td>
                                        <td>{{ avaliacao.ordem_de_servico.check_in|date:"d/m/Y H:i" }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="alert alert-warning mt-3 mb-0">Nenhuma avaliação de coordenador encontrada.</div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {% if perms.pesquisasSatisfacao.view_avaliacaocolegio or perms.pesquisasSatisfacao.view_avaliacaocorporativo %}
                <!-- Avaliações de Clientes -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        Avaliações de Clientes
                    </div>
                    <div class="card-body table-responsive">
                        {% if avaliacoes_clientes %}
                            <table class="table table-striped table-bordered align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Cliente</th>
                                    <th>Check-in</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for avaliacao in avaliacoes_clientes %}
                                    <tr style="cursor: pointer" {% if avaliacao.ordem_de_servico.ficha_de_evento.produto.colegio %} onclick="window.location.href='{% url 'ver_avaliacao_colegio' avaliacao.id %}'" {% else %} onclick="window.location.href='{% url 'ver_avaliacao_corporativo' avaliacao.id %}'" {% endif %}>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ avaliacao.ordem_de_servico.instituicao }}</td>
                                        <td>{{ avaliacao.ordem_de_servico.check_in|date:"d/m/Y H:i" }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="alert alert-warning mt-3 mb-0">Nenhuma avaliação de cliente encontrada.</div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

        </div>
    </div>
{% endblock %}
